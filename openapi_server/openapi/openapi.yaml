openapi: 3.0.4
info:
  title: Microservicio Recomendaciones
  version: 1.0.0
  description: Registro de reproducciones, likes y generación de recomendaciones personalizadas.
servers:
  - url: /
tags:
  - name: recommendations
    description: Recomendaciones personalizadas y métricas de reproducciones y likes.

paths:
  /metrics/likes:
    post:
      summary: Registrar like
      description: Registra un nuevo like de una canción por parte de un usuario.
      operationId: add_like
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/like'
      responses:
        "201":
          description: Like registrado correctamente
        "400":
          description: Bad Request (Datos inválidos)
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /metrics/plays:
    post:
      summary: Registrar reproducción
      description: Registra una nueva reproducción de una canción por parte de un usuario.
      operationId: add_play
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/play'
      responses:
        "201":
          description: Play registrada correctamente
        "400":
          description: Bad Request (Datos inválidos)
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /metrics/artists/{idArtist}/plays:
    get:
      summary: Obtener reproducciones por artista
      description: Devuelve las reproducciones asociadas a un artista.
      operationId: get_artist_plays
      parameters:
        - name: idArtist
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/play'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /metrics/tracks/{idTrack}/likes:
    get:
      summary: Obtener likes por canción
      description: Devuelve los likes de una canción.
      operationId: get_track_likes
      parameters:
        - name: idTrack
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/like'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /metrics/tracks/{idTrack}/plays:
    get:
      summary: Obtener reproducciones por canción
      description: Devuelve las reproducciones de una canción.
      operationId: get_track_plays
      parameters:
        - name: idTrack
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/play'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /metrics/users/{idUser}/likes:
    get:
      summary: Obtener likes de usuario
      description: Devuelve los likes del usuario.
      operationId: get_user_likes
      parameters:
        - name: idUser
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/like'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /metrics/users/{idUser}/plays:
    get:
      summary: Obtener reproducciones de usuario
      description: Devuelve las reproducciones del usuario.
      operationId: get_user_plays
      parameters:
        - name: idUser
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/play'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /recommendations/artists/{idArtist}/top-tracks:
    get:
      summary: Canciones más escuchadas por artista
      description: Devuelve las canciones más escuchadas de un artista.
      operationId: get_artist_top_tracks
      parameters:
        - name: idArtist
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/track'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  /recommendations/tracks/top:
    get:
      summary: Canciones más escuchadas
      description: Devuelve el listado de canciones más escuchadas.
      operationId: get_top_tracks
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/track'
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

# -------------------------------------------------------------
  # NUEVO ENDPOINT 1: Recomendaciones por GÉNERO
  # -------------------------------------------------------------
  /recommendations/users/{idUser}/recommended-tracks/genre:
    get:
      summary: Consultar recomendaciones por género
      description: Devuelve canciones recomendadas basadas en el género favorito reciente.
      operationId: get_recommended_tracks_by_genre
      parameters:
        - name: idUser
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/track'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

  # -------------------------------------------------------------
  # NUEVO ENDPOINT 2: Recomendaciones por LIKES (Collaborative)
  # -------------------------------------------------------------
  /recommendations/users/{idUser}/recommended-tracks/like:
    get:
      summary: Consultar recomendaciones por likes
      description: Devuelve canciones recomendadas basadas en filtrado colaborativo (likes de otros usuarios).
      operationId: get_recommended_tracks_by_like
      parameters:
        - name: idUser
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/track'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/track'
        "404":
          description: Not Found
      tags:
        - recommendations
      x-openapi-router-controller: openapi_server.controllers.recommendations_controller

components:
  schemas:

    like:
      type: object
      properties:
        id:
          type: integer
          format: int64
          readOnly: true
        user_id:
          type: integer
          format: int64
        track_id:
          type: integer
          format: int64
        timestamp:
          type: string
          format: date-time
      required:
        - user_id
        - track_id

    play:
      type: object
      properties:
        id:
          type: integer
          format: int64
          readOnly: true
        user_id:
          type: integer
          format: int64
        track_id:
          type: integer
          format: int64
        timestamp:
          type: string
          format: date-time
      required:
        - user_id
        - track_id

    track:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        artist_id:
          type: integer
          format: int64
        genre:
          type: string
      required:
        - id
        - name
        - artist_id
